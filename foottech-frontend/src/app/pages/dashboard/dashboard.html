<section class="dashboard">
  <div class="container dashboard__container">
    <header class="dashboard__header">
      <div>
        <h1 class="dashboard__title">Bienvenido {{ me?.name | titlecase }}</h1>
        <p class="dashboard__subtitle">Rol: <span class="badge bg-primary">{{ me?.role }}</span></p>
      </div>
    </header>

    @if (loading()) {
      <div class="dashboard__loading card p-4">
        <div class="spinner-border" role="status"></div>
        <span class="ms-3">Cargando datos…</span>
      </div>
    } @else {

      @if (me && me.role === 'admin') {
        <section class="dashboard__section">
          <h2 class="dashboard__sectionTitle">Entrenadores</h2>

          @if (entrenadoresWithJugadores().length === 0) {
            <div class="empty card p-4">No hay entrenadores registrados.</div>
          }

          @for (block of entrenadoresWithJugadores(); track block.entrenador.id) {
            <div class="panel card">
              <div class="panel__head">
                <div class="userCard">
                  <div class="userAvatar">{{ block.entrenador.name?.[0] }}</div>
                  <div>
                    <div class="userName">{{ block.entrenador.name }}</div>
                    <div class="userMeta">{{ block.entrenador.email }}</div>
                    <div class="userMeta small text-muted">{{ block.entrenador.role?.name }}</div>
                  </div>
                </div>
              </div>

              <div class="panel__body">
                <h3 class="panel__title">Jugadores asignados</h3>

                <div class="gridCards">
                  @for (p of block.jugadores; track p.id) {
                    <article class="miniCard">
                      <div class="miniCard__top">
                        <div class="miniAvatar">{{ p.name[0] }}</div>
                        <div class="miniInfo">
                          <div class="miniName">{{ p.name }}</div>
                          <div class="miniMeta">{{ p.email }}</div>
                        </div>
                      </div>
                      <div class="miniFooter">
                        <span class="badge bg-light text-dark">{{ p.role }}</span>
                      </div>
                    </article>
                  }
                </div>
              </div>
            </div>
          }
        </section>
      }

      @if (me && me.role === 'entrenador') {
        <section class="dashboard__section">
          <h2 class="dashboard__sectionTitle">Tus jugadores</h2>

          @if (misJugadores.length === 0) {
            <div class="empty card p-4">No tienes jugadores asignados.</div>
          } @else {
            <div class="gridCards">
              @for (p of misJugadores; track p.id) {
                <article class="miniCard">
                  <div class="miniCard__top">
                    <div class="miniAvatar">{{ p.name[0] }}</div>
                    <div class="miniInfo">
                      <div class="miniName">{{ p.name }}</div>
                      <div class="miniMeta">{{ p.email }}</div>
                    </div>
                  </div>
                  <div class="miniFooter">
                    <span class="badge bg-light text-dark">{{ p.role }}</span>
                  </div>
                </article>
              }
            </div>
          }
        </section>
      }

      @if (me && me.role === 'jugador') {
        <section class="dashboard__section">
          <h2 class="dashboard__sectionTitle">Tu entrenador y compañeros</h2>

          @if (!miEntrenador) {
            <div class="empty card p-4">No tienes entrenador asignado.</div>
          } @else {
            <div class="panel card">
              <div class="panel__head">
                <div class="userCard">
                  <div class="userAvatar">{{ miEntrenador.name?.[0] }}</div>
                  <div>
                    <div class="userName">{{ miEntrenador.name }}</div>
                    <div class="userMeta">{{ miEntrenador.email }}</div>
                    <div class="userMeta small text-muted">{{ miEntrenador.role?.name }}</div>
                  </div>
                </div>
              </div>
            </div>
          }

          @if (misCompaneros.length === 0) {
            <div class="empty card p-4 mt-3">No tienes compañeros asignados.</div>
          } @else {
            <h3 class="panel__title mt-4">Compañeros</h3>
            <div class="gridCards">
              @for (p of misCompaneros; track p.id) {
                <article class="miniCard">
                  <div class="miniCard__top">
                    <div class="miniAvatar">{{ p.name[0] }}</div>
                    <div class="miniInfo">
                      <div class="miniName">{{ p.name }}</div>
                      <div class="miniMeta">{{ p.email }}</div>
                    </div>
                  </div>
                  <div class="miniFooter">
                    <span class="badge bg-light text-dark">{{ p.role }}</span>
                  </div>
                </article>
              }
            </div>
          }
        </section>
      }
    }
  </div>
</section>
